<!DOCTYPE html>
<html>
<head>
	<title>I Like Babes Daily</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link rel="stylesheet" href="http://current.bootstrapcdn.com/bootstrap-v204/css/bootstrap.min.css" media="all" />
	<script type="text/javascript">
	var last_id = null,
		max_tweets = 20,
		num_requests = 0, queue = [];
	
	function rearrange_cols() {
		var col1 = $('#timeline .col1'),
		 	col2 = $('#timeline .col2'),
			tempCol = null;
		
		if(col1.height() < col2.height()) {
			tempCol = col2;
			col2 = col1;
			col1 = tempCol;
		}
		
		do {
			var child = $('.thumbnail:last-child', col1),
				childHeight = 0;
			
			if(!child.length) {
				return;
			}
			
			childHeight = child.height();
			
			if(col1.height()-childHeight < col2.height()) {
				return;
			}
			
			child.remove();
			col2.append(child);
		} while(col1.height() > col2.height());
	}
	
	function load_tweets(max_id)
	{
		$('#load_more').attr('disabled', true);
		
		queue = [];
		num_requests = 0;
		
		$.ajax({
			url: 'https://twitter.com/statuses/user_timeline/iLikeBabesDaily.json?count=' + max_tweets + (max_id ? '&max_id=' + max_id : ''),
			dataType: "jsonp",
			crossDomain: true,
			success: function (data) {
			
				$.each(data, function (index, obj) {
					var test = /\b(?:(?:https?|ftp|file):\/\/)[-A-Z0-9+&@#\/%=~_|$?!:,.]*[A-Z0-9+&@#\/%=~_|$]/i,
						links = obj.text.match(test);
				
					if(index == 0) {
						$('#userpic').attr('src', obj.user.profile_image_url).show();
					}
				
					if(links && links.length && obj.id != last_id) {
						var item = $('<div class="thumbnail"><a href="#" target="_blank"><img src="#" style="max-width:100%" alt="" /></a><div class="caption"><p></p></div></div>')
						.find('p').text(obj.text).end()
						.find('a').attr('href', links[0]).end()
						.hide();
					
						queue.push({
							url: 'http://api.longurl.org/v2/expand?url=' + encodeURI(links[0]) + '&format=json',
							dataType: "jsonp",
							crossDomain: true,
							success: function (data) {
								if(/(.png|.gif|.jpg|.jpeg)/.test(data['long-url'])) {
									item.find('img')
										.bind('load error', function () {
											num_requests--;
											if(num_requests < 1) {
												rearrange_cols();
												$('#load_more').attr('disabled', false);
											}
										})
										.attr('src', data['long-url']).end()
										.show();
								} else {
									num_requests--;
								}
							},
							error: function () {
								num_requests--;
							}
						});
					
						$('#timeline .' + (index % 2 == 0 ? 'col1' : 'col2')).append(item);
					}
				});
				
				last_id = data[data.length-1].id;
				num_requests = queue.length;
				
				$.each(queue, function (index, obj) {
					$.ajax(obj);
				});
			},
			error: function () {
				$('#load_more').attr('disabled', false);
			}
		});
	}
	
	$(document).ready(function () {
		$('#load_more').click(function (evt) {
			load_tweets(last_id);
			evt.preventDefault();
		});
		
		load_tweets();
	});
	</script>
	<style type="text/css">
	body {
		margin-bottom:40px;
	}
	#timeline .thumbnail {
		margin-bottom: 25px;
		width:460px;
	}
	</style>
</head>
<body>
	<div class="navbar">
		<div class="navbar-inner">
			<div class="container">
				<button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="brand" href="https://twitter.com/#!/iLikeBabesDaily"><span style="width:24px;height:24px;display:inline-block;vertical-align:text-top;"><img src="#" id="userpic" style="display:none;width:24px;height:24px;border-radius:4px;" /></span> @iLikeBabesDaily</a>
			</div>
		</div>
	</div>
	<div class="container">
		<div id="timeline" class="row">
			<div class="col1 span6"></div>
			<div class="col2 span6"></div>
		</div>
		<p style="text-align:center;"><button id="load_more" class="btn btn-large" disabled="disabled">Load more</button></p>
		
		<div class="footer">
			<p class="pull-right"><a href="#">Back to top</a></p>
			<p>Naturally designed and built by <a href="http://twitter.com/pronebird" target="_blank">@pronebird</a>.</p>
			<p>This is a secret page. However if you get here, make sure you are over 18 before using it. Stuff is not mine, blame twitter.</p>
		</div>
	</div>

</body>
</html>